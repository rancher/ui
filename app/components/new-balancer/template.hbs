<section class="header">
  <h1>Add Load Balancer {{help-btn link="/rancher-ui/applications/stacks/adding-balancers/"}}</h1>
</section>

<section class="horizontal-form container-fluid">
  {{form-scale
    initialLabels=launchConfig.labels
    initialScale=service.scale
    isGlobal=isGlobal
    errors=scaleErrors
    setLabels=(action 'setLabels' 'scale')
    setGlobal=(action 'setGlobal')
    setScale=(action  'setScale')
  }}

  {{form-name-description
    model=service
    namePlaceholder="servicePage.newBalancer.form.name.placeholder"
    descriptionPlaceholder="servicePage.newBalancer.form.description.placeholder"
  }}

  {{form-balancer-listeners
    initialPorts=launchConfig.ports
    initialExpose=launchConfig.expose
    initialLabels=launchConfig.labels
    changed=(action "setListeners")
    setLabels=(action 'setLabels' 'ssl')
  }}

  {{#if showAdvancedMatchingWarning}}
    <div class="row">
      <div class="col-sm-12 col-md-8 col-md-offset-2">
        <div class="alert alert-info">
          <b>Note:</b> Requests that do not match any of the &quot;advanced request options&quot; will be sent to the <b>all</b> ({{targetResources.length}}) of the configured target services (round-robin) on the default target port corresponding to the source port of the request.
        </div>
      </div>
    </div>
  {{/if}}

  {{form-targets
    isBalancer=true
    existing=existing
    allServices=allServices
    changed=(action "setTargets")
  }}

  
</section>

<section>
  <ul class="nav nav-tabs nav-tabs-well shadowed" style="display: inline-block" role="tablist">
    <li role="tab" class="tab" data-section="ssl" {{action "selectTab" "ssl" target=view}}><a href="#">SSL Termination</a></li>
    <li role="tab" class="tab" data-section="stickiness" {{action "selectTab" "stickiness" target=view}}><a href="#">Stickiness</a></li>
    <li role="tab" class="tab" data-section="custom" {{action "selectTab" "custom" target=view}}><a href="#">Custom haproxy.cfg</a></li>
    <li role="tab" class="tab" data-section="labels" {{action "selectTab" "labels" target=view}}><a href="#">Labels</a></li>
    <li role="tab" class="tab" data-section="scheduling" {{action "selectTab" "scheduling" target=view}}><a href="#">Scheduling</a></li>
  </ul>


<div class="horizontal-form well" role="tabpanel">
  <div class="section container-fluid tab-section" data-section="ssl">
    {{form-ssl-termination
      balancer=service
      hasSslListeners=hasSslListeners
      launchConfig=launchConfig
      allCertificates=allCertificates
    }}
  </div>

  <div class="section container-fluid tab-section" data-section="stickiness">
    {{form-stickiness
      config=balancerConfig
      hasHttpListeners=hasHttpListeners
    }}
  </div>

  <div class="section container-fluid tab-section" data-section="custom">
    <p class="help-block">Additional <a href="http://cbonte.github.io/haproxy-dconv/configuration-1.5.html" target="_blank">haproxy.cfg</a> configuration can be put here and will be appended to the configuration generated by {{settings.appName}}.</p>

    <div class="row form-group">
      <div class="col-md-6">
        <label class="r-pt5 r-pb5"><code>global</code> section</label>
        {{textarea
          value=haproxyConfig.global
          prompt="Custom global section lines"
          rows="8"
          classNames="form-control"
        }}
      </div>
      <div class="col-md-6">
        <label class="r-pt5 r-pb5"><code>defaults</code> section</label>
        {{textarea
          value=haproxyConfig.defaults
          prompt="Custom defaults section lines"
          rows="8"
          classNames="form-control"
        }}
      </div>
    </div>
  </div>

  <div class="section" data-section="labels">
    {{form-user-labels
      initialLabels=launchConfig.labels
      setLabels=(action 'setLabels' 'user')
    }}
  </div>

  <div class="section" data-section="scheduling">
    {{form-scheduling
      isService=true
      isGlobal=isGlobal
      canRequestHost=false
      initialHostId=launchConfig.requestedHostId
      initialLabels=launchConfig.labels
      errors=schedulingErrors
      allHosts=allHosts
      setLabels=(action 'setLabels' 'scheduling')
      setGlobal=(action 'setGlobal')
    }}
  </div>
</div>
</section>

{{top-errors errors=errors}}
{{save-cancel save="save" cancel="cancel"}}
